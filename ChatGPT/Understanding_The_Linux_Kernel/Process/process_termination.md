在 Linux 内核中，进程的终止、撤销和删除是三个不同的过程，分别处理进程的结束、从任务队列中移除以及释放其资源。它们的工作机制如下：

### 1. 进程终止（Termination）

进程终止是指进程完成其执行任务，退出运行状态。常见的终止方式包括进程自己调用 `exit` 系统调用，或被其他进程发送信号（如 `SIGTERM`、`SIGKILL`）终止。以下是进程终止的工作机制：

#### 1.1 进程自己调用 `exit`

1. **用户态调用 `exit`**：
    - 用户态进程调用 `exit` 或 `_exit` 系统调用。

2. **进入内核态**：
    - 进入内核态，调用 `sys_exit` 系统调用。

3. **调用 `do_exit`**：
    - `sys_exit` 调用 `do_exit` 函数执行实际的退出操作。

4. **设置进程状态**：
    - `do_exit` 设置进程状态为 `TASK_DEAD`，表示进程已经终止。

5. **释放资源**：
    - 关闭文件描述符、释放内存、解除内存映射等资源。

6. **发送信号**：
    - 向父进程发送 `SIGCHLD` 信号，通知其子进程已终止。

7. **调用调度器**：
    - 调用调度器，切换到其他进程运行。

#### 1.2 通过信号终止

1. **接收终止信号**：
    - 进程接收到终止信号（如 `SIGTERM`、`SIGKILL`）。

2. **信号处理**：
    - 调用信号处理函数，处理终止信号。

3. **调用 `do_exit`**：
    - 信号处理函数调用 `do_exit` 函数，执行终止过程。

### 2. 进程撤销（Reaping）

进程撤销是指清理已经终止的进程，通常由父进程通过 `wait` 系列系统调用完成。撤销过程确保父进程可以获取子进程的终止状态，并从进程表中移除子进程。

#### 2.1 父进程调用 `wait`

1. **用户态调用 `wait` 系统调用**：
    - 父进程调用 `wait`、`waitpid`、`waitid` 或 `wait3`、`wait4` 系统调用。

2. **进入内核态**：
    - 进入内核态，调用相应的系统调用处理函数。

3. **查找终止的子进程**：
    - 系统调用处理函数查找已终止的子进程。

4. **获取终止状态**：
    - 获取子进程的终止状态，并将其返回给父进程。

5. **调用 `release_task`**：
    - 调用 `release_task` 函数，释放子进程的资源。

### 3. 进程删除（Deletion）

进程删除是指完全从系统中移除进程并释放其所有资源。删除过程在撤销（reaping）之后进行。

#### 3.1 `release_task` 函数

1. **调用 `release_task`**：
    - 当父进程通过 `wait` 系统调用撤销子进程时，调用 `release_task` 函数。

2. **从任务队列中移除**：
    - 将进程从任务队列中移除，断开与其他进程的关联。

3. **释放内核对象**：
    - 释放与进程相关的内核对象，如 `task_struct`、内存描述符等。

4. **调用 `put_task_struct`**：
    - 调用 `put_task_struct` 函数，减少 `task_struct` 的引用计数，当引用计数为 0 时，释放其内存。

### 总结

- **进程终止（Termination）**：进程结束执行，调用 `do_exit` 函数，设置状态为 `TASK_DEAD`，释放资源，通知父进程。
- **进程撤销（Reaping）**：父进程通过 `wait` 系统调用获取子进程的终止状态，调用 `release_task` 函数清理子进程。
- **进程删除（Deletion）**：调用 `release_task` 后，完全从系统中移除进程，释放所有资源。

这三个过程确保了进程从结束到完全清除的完整生命周期管理，避免资源泄漏和系统不稳定。