在 DHCP（动态主机配置协议）中，**租用（Lease）** 是指客户端从 DHCP 服务器动态获取 IP 地址和相关网络配置信息（如子网掩码、网关、DNS 服务器地址）的一种临时分配方式。租用的概念意味着客户端获得的 IP 地址并不是永久的，而是有一个**租期（Lease Time）**，即使用这个 IP 地址的有效时间。

### DHCP 租用的工作原理

1. **IP 地址的动态分配**
    - 当客户端（如计算机或移动设备）加入网络时，它会向 DHCP 服务器请求一个 IP 地址。DHCP 服务器会根据其配置，从可用的 IP 地址池中分配一个 IP 地址给客户端，这个过程叫做**动态分配**。
    - 服务器在分配 IP 地址的同时，会附带一个租用时间，即这个 IP 地址的有效期。

2. **租期（Lease Time）**
    - DHCP 服务器为客户端分配 IP 地址时，通常会指定一个租期。租期的长短可以根据网络管理员的配置而定，可能是几小时、几天，甚至几周。
    - **租期到期后**，如果客户端仍然需要这个 IP 地址，它需要向 DHCP 服务器重新申请续租。否则，服务器可以将这个 IP 地址释放回地址池，分配给其他设备使用。

3. **租用的生命周期**

   **（1）DHCP 发现（DHCP Discovery）**
    - 当客户端首次加入网络时，它会广播一个 DHCP 发现消息，表示自己需要一个 IP 地址。

   **（2）DHCP 提供（DHCP Offer）**
    - DHCP 服务器接收到发现消息后，会检查可用的 IP 地址池，并通过 DHCP 提供消息，向客户端提供一个可用的 IP 地址和租期等信息。

   **（3）DHCP 请求（DHCP Request）**
    - 客户端接收到多个 DHCP 提供时，会选择其中一个，并向服务器发送 DHCP 请求消息，确认接收这个 IP 地址。

   **（4）DHCP 确认（DHCP Acknowledgment）**
    - DHCP 服务器接收到客户端的请求后，会发送 DHCP 确认消息，正式将该 IP 地址租给客户端，并记录租期的开始时间和结束时间。

4. **续租（Lease Renewal）**
    - 在租期即将到期时（一般是租期过半时），客户端会尝试向 DHCP 服务器发送 **DHCP 请求（DHCP Request）** 消息，要求延长 IP 地址的租期。这被称为**续租**过程。
    - 如果 DHCP 服务器同意续租，它会发送一个 DHCP 确认（DHCP ACK）消息，并为客户端延长租期。
    - 如果续租失败，客户端会继续尝试直到租期结束。在租期到期前，客户端会努力确保其 IP 地址仍然有效。

5. **租期结束**
    - 如果客户端在租期结束时没有成功续租，则 IP 地址会被服务器收回，并可以分配给其他设备使用。
    - 此时，客户端如果还需要继续上网，它需要重新向 DHCP 服务器申请新的 IP 地址，重新开始租用过程。

### DHCP 租用的关键要点

- **租期灵活性**：租期可以灵活配置，长租期适合网络拓扑相对稳定的环境，短租期适合大量设备频繁进出网络的环境。
- **IP 地址的释放**：当客户端不再需要网络连接时，客户端可以主动释放 IP 地址，通过发送 **DHCP Release** 消息给 DHCP 服务器。此时，IP 地址立即被释放回地址池，供其他设备使用。
- **续租机制**：为了防止租用的 IP 地址失效，客户端会在租期到期前请求续租。续租是自动进行的，客户端在租期的50% 时首次尝试续租，若失败则会在租期的 87.5% 时再次尝试。

### DHCP 租用的优点

- **动态分配**：通过租用机制，网络管理员可以高效地管理 IP 地址资源。由于 IP 地址是临时分配的，当设备离开网络时，IP 地址可以被其他设备重新使用，避免了 IP 地址的浪费。
- **灵活性**：设备在不同的网络中可以随时自动获取 IP 地址，不需要用户手动配置。尤其在大型网络中，自动分配大大减少了管理的复杂性。
- **减少冲突**：通过 DHCP 服务器的集中管理，确保网络中设备不会因为手动配置错误而产生 IP 地址冲突。

### 总结

在 DHCP 协议中，租用是指客户端从 DHCP 服务器临时获得 IP 地址的过程，租期的长短由 DHCP 服务器设定。租用的灵活性使得网络中的 IP 地址可以得到高效利用，客户端可以自动获取、续租和释放 IP 地址，从而保持网络的高效运行和管理的便捷性。
